<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>South Carolina WFS Map</title>

  <!-- OpenLayers CDN -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@7.3.0/ol.css">
  <script src="https://cdn.jsdelivr.net/npm/ol@7.3.0/dist/ol.js"></script>

  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      width: 100%;
    }
    #map {
      width: 100%;
      height: 100vh;
    }
  </style>
</head>

<body>

<div id="map"></div>

<script>
// ----------------------------
// 1. WFS URL
// ----------------------------
const wfsUrl =
  "http://3.145.133.49:8080/geoserver/ewrigh58/ows?" +
  "service=WFS&version=1.1.0&request=GetFeature&" +
  "typename=ewrigh58:lidar_stream&" +
  "outputFormat=application/json&srsname=EPSG:4326";

// ----------------------------
// 2. WFS Source (GeoJSON)
// ----------------------------
const wfsSource = new ol.source.Vector({
  format: new ol.format.GeoJSON({
    dataProjection: "EPSG:4326",     // GeoServer output (lon/lat)
    featureProjection: "EPSG:3857"   // Convert to Web Mercator
  }),
  url: wfsUrl,
  strategy: ol.loadingstrategy.all
});

// ----------------------------
// 3. Vector Layer Style
// ----------------------------
const wfsLayer = new ol.layer.Vector({
  source: wfsSource,
  style: new ol.style.Style({
    stroke: new ol.style.Stroke({
      color: "blue",
      width: 2
    }),
    fill: new ol.style.Fill({
      color: "rgba(0, 0, 255, 0.2)"
    })
  })
});

// ----------------------------
// 4. Map
// ----------------------------
const map = new ol.Map({
  target: "map",
  layers: [
    new ol.layer.Tile({
      source: new ol.source.OSM()    // Basemap
    }),
    wfsLayer
  ],
  view: new ol.View({
    center: ol.proj.fromLonLat([-79.8, 33.1]),  // General SC center
    zoom: 8
  })
});

// ----------------------------
// 5. Auto-zoom to layer extent
// ----------------------------
wfsSource.on("change", function () {
  if (wfsSource.getState() === "ready") {
    const extent = wfsSource.getExtent();
    if (extent) {
      map.getView().fit(extent, { padding: [50, 50, 50, 50] });
    }
  }
});
</script>

</body>
</html>
