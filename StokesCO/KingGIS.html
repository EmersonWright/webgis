<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>King, NC GIS Viewer (Stokes County Data)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link rel="stylesheet" href="https://js.arcgis.com/3.31/dijit/themes/claro/claro.css">
  <link rel="stylesheet" href="https://js.arcgis.com/3.31/esri/css/esri.css">
  <style>
    html, body, #mapDiv {
      height: 100%;
      width: 100%;
      margin: 0;
      padding: 0;
    }
  </style>

  <script>
    var dojoConfig = { parseOnLoad: true };
  </script>
  <script src="https://js.arcgis.com/3.31/"></script>
</head>

<body class="claro">
  <div id="mapDiv"></div>

  <script>
    require([
      "esri/map",
      "esri/layers/FeatureLayer",
      "esri/tasks/query",
      "esri/tasks/QueryTask",
      "esri/symbols/SimpleFillSymbol",
      "esri/symbols/SimpleLineSymbol",
      "esri/Color",
      "dojo/domReady!"
    ], function(
      Map, FeatureLayer, Query, QueryTask,
      SimpleFillSymbol, SimpleLineSymbol, Color
    ) {

      // Initialize map centered on Stokes County
      var map = new Map("mapDiv", {
        basemap: "streets",
        center: [-80.3595, 36.2818], // King, NC coordinates
        zoom: 12
      });

      // City Limits layer (index 16 in the AllLayers service)
      var cityLimitsUrl = "https://stokescountygis.com/server/rest/services/AllLayers/MapServer/16";

      // Query for King city boundary
      var queryTask = new QueryTask(cityLimitsUrl);
      var query = new Query();
      query.where = "CITY_NAME = 'King' OR NAME = 'King'"; // try both possible field names
      query.outFields = ["*"];
      query.returnGeometry = true;

      queryTask.execute(query, function(results) {
        if (results.features.length > 0) {
          var feature = results.features[0];

          // Symbolize the King boundary
          var symbol = new SimpleFillSymbol(
            SimpleFillSymbol.STYLE_SOLID,
            new SimpleLineSymbol(SimpleLineSymbol.STYLE_SOLID, new Color([0, 0, 255]), 2),
            new Color([0, 0, 255, 0.15])
          );
          feature.setSymbol(symbol);

          // Add to map and zoom to it
          map.graphics.add(feature);
          map.setExtent(feature.geometry.getExtent().expand(1.2));
        } else {
          alert("No King city boundary found in City Limits layer.");
        }
      });

      // (Optional) You can also add parcels or structures filtered to King later
      // Example: var parcels = new FeatureLayer("https://stokescountygis.com/server/rest/services/AllLayers/MapServer/24");
      // parcels.setDefinitionExpression("CITY_NAME = 'King'");
      // map.addLayer(parcels);

    });
  </script>
</body>
</html>
